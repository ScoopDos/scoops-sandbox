name: Discord Commit Embed

on:
  push:
    branches:
      - main  # or your dev branch

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Get list of changed files
        id: changes
        run: |
          FILES=$(git diff --name-status HEAD~1 HEAD | sed 's/\t/ /g' | paste -sd ', ' -)
          echo "files=$FILES" >> "$GITHUB_OUTPUT"

      - name: Send embed to Discord
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          FILES_CHANGED="${{ steps.changes.outputs.files }}"
          echo "{\"username\": \"Scoop Update Bot\",
            \"avatar_url\": \"https://i.imgur.com/your-logo.png\",
            \"embeds\": [{
              \"title\": \"🛠️ New Commit to Scoop's Sandbox\",
              \"description\": \"${{ github.event.head_commit.message }}\",
              \"url\": \"${{ github.event.head_commit.url }}\",
              \"color\": 5814783,
              \"fields\": [
                {
                  \"name\": \"Author\",
                  \"value\": \"${{ github.actor }}\",
                  \"inline\": true
                },
                {
                  \"name\": \"Branch\",
                  \"value\": \"${{ github.ref_name }}\",
                  \"inline\": true
                },
                {
                  \"name\": \"Files Changed\",
                  \"value\": \"$FILES_CHANGED\"
                }
              ],
              \"footer\": {
                \"text\": \"Scoop's Projects\"
              },
              \"timestamp\": \"${{ github.event.head_commit.timestamp }}\"
            }]}" > payload.json

          curl -H "Content-Type: application/json" \
               -X POST \
               -d @payload.json \
               "$DISCORD_WEBHOOK"
